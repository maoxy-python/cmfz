<script>
    $(function () {
        $("#bannerTable").jqGrid({
            url: "/carousel/query",
            datatype: "json",
            styleUI: "Bootstrap",
            autowidth: true,
            height: 300,
            pager: "#bannerPagerNew",
            viewrecords: true,
            rownumbers: true,
            multiselect: false,
            rowNum: 3,
            rowList: [2, 5, 8],
            editurl: "/carousel/editBanner/",
            colNames: ["编号", "标题", "状态", "描述", "创建时间", "图片", "操作"],
            colModel: [
                {name: "id", align: "center",hidden:true},
                {name: "title", align: "center", editable: true, editrules: {required: true}},
                {
                    name: "status", align: "center", editable: true, edittype: "select", editoptions: {
                        value: "1:展示;2:不展示",
                    }
                },
                {name: "description", align: "center", editable: true, editrules: {required: true}},
                {
                    name: "createDate",
                    align: "center",
                },
                {
                    name: "url",
                    //index: "url",
                    align: "center",
                    //editable: true,
                    //edittype: "file",
                    //editoptions: {enctype: "multipart/form-data"},
                    formatter: function (cellValue) {
                        console.log(cellValue)
                        return "<img style='height: 80px;width: 180px' src='/static/upload/" + cellValue + " '/>"
                    },
                },
                {
                    name:'options',
                    formatter:function (value,options,row) {
                        console.log(options);
                        var content = "<a class='btn btn-danger'><span class=' glyphicon glyphicon-duplicate'> 删除</span></a>" +
                                "<a class='btn btn-primary' onclick=\'javascript:edit(\""+options.rowId+"\")\'><span class=' glyphicon glyphicon-king'> 修改</span></a>";
                        return content
                    }
                },
            ],

        });




        <!-- 点击添加按钮后完成文件上传的方法 -->
        $("#save").click(function () {

            //发送ajax请求更新保存数据   在响应回来后关闭模态框
            var upload_name1 = $.trim($('#upload_name1').val());
            var upload_title1 = $.trim($('#upload_title1').val());
            var upload_status1 = $.trim($('#upload_status1').val());
            var upload_pic1 = $('#upload_pic1')[0].files[0];

            var formData = new FormData();

            formData.append("upload_name1", upload_name1);
            formData.append("upload_title1", upload_title1);
            formData.append("upload_status1", upload_status1);
            formData.append("upload_pic1",$('#upload_pic1')[0].files[0]);
            
            $.ajax({
                url: '/carousel/upload_file/',
                datatype: 'json',
                type: 'POST',
                async: false,
                data: formData,
                processData: false, //使数据不做处理
                contentType: false, //不要设置contentType请求头
                success: function (data) {
                    $("#myModal1").modal('hide');
                    // 获取更新后的数据
                    $('#bannerTable').trigger("reloadGrid");

                    if (data.status == 'ok'){
                        alert('上传成功')
                    }
                },
            });


        });

        // 点击修改事件
        $("#edit").click(function() {
            var gr = jQuery("#bannerTable").jqGrid('getGridParam', 'selrow');
            if (gr != null)
              $("#bannerTable").jqGrid('editGridRow', gr, {
                height : 300,
                reloadAfterSubmit : true
              });
            else
              alert("Please Select Row");
        });

        //删除一行
        $("#del").click(function () {
            var gr = jQuery("#bannerTable").jqGrid('getGridParam', 'selrow');
            if (gr != null)
              $("#bannerTable").jqGrid('delGridRow', gr, {
                reloadAfterSubmit : false
              });
            else
              alert("请选择要删除的行!");
        });

    });


    <!-- 点击修改按钮后完成修改的方法 -->
    function edit(id) {
        alert('111')
        // 根据rowid获取当前行的方法
        $("#bannerTable").jqGrid('editGridRow', id, {
            height : 300,
            reloadAfterSubmit : true
        });
    }

    function outBanner() {
        location.href="${app}/banner/outBanner";
    }

</script>
<div class="page-header">
    <h2>轮播图管理</h2>
</div>
<ul class="nav nav-tabs ">
    <li class="active"><a href="#"><b>轮播图信息</b></a></li>
    <li><a style="font-weight: bold" onclick="outBanner();">导出轮播图</a></li>
</ul>

<div class="panel panel-default" style="padding: 40px">
    <table id="bannerTable"></table>
    <div class="alert alert-success" role="alert" id="addBannerMsg" style="display: none">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <strong id="msgShow"></strong>
    </div>
    <div id="bannerPagerNew" style="width: auto;height: 50px"></div>
    <button class="btn btn-primary" data-aa="@456" data-whatever="@123" id="btn" data-toggle="modal" data-target="#myModal1">添加</button>
    <button class="btn btn-warning" id="edit">修改</button>
    <button class="btn btn-danger" id="del">删除</button>
</div>


<body>

<!--<button class="btn btn-default" data-aa="@456" data-whatever="@123" id="btn" data-toggle="modal" data-target="#myModal">添加</button>-->

<!--静态模态框-->

<div class="modal fade" tabindex="-1" data-backdrop="false" role="dialog" id="myModal1">
  <div class="modal-dialog">
      <!--模态框内容-->
    <div class="modal-content">
        <!--模态框标题-->
      <div class="modal-header">
          <!--
          关闭模态框的属性：data-dismiss="modal"
          -->
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h4 class="modal-title">编辑用户信息</h4>
      </div>
        <!--模态框内容体-->
        <form action="" id="bannerForm">
          <div class="modal-body form-horizontal">
                  <div class="form-group ">
                      <label class="col-sm-2 control-label">用户名：</label>
                      <div class="col-sm-10">
                      <input type="text" name="name" id="upload_name1" class="form-control" placeholder="请输入姓名">
                      </div>
                  </div>
                  <div class="form-group ">
                      <label class="col-sm-2 control-label">标题：</label>
                      <div class="col-sm-10">
                      <input type="text" name="title" id="upload_title1" class="form-control" placeholder="请输入姓名">
                      </div>
                  </div>
                  <div class="form-group ">
                      <label class="col-sm-2 control-label">状态：</label>
                      <div class="col-sm-10">
                      <input type="text" name="status" id="upload_status1" class="form-control" placeholder="请输入姓名">
                      </div>
                  </div>
                  <div class="form-group ">
                      <label class="col-sm-2 control-label">图片：</label>
                      <div class="col-sm-10">
                      <input type="file" name="pic" id="upload_pic1" class="form-control" placeholder="请输入姓名">
                      </div>
                  </div>
                  <div class="form-group">
                      <!-- <button type="button" class="btn btn-primary" id="save" >保存</button>-->
                  </div>

          </div>
        </form>
        <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="save" >保存</button>
        </div>
    </div>
  </div>
</div>

</body>
